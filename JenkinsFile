pipeline {
  agent any
  stages {
    stage('Build') {
      steps {
        echo 'Setup Python VirtualEnv'
        sh 'virtualenv venv'
        sh 'source venv/bin/activate'
        sh 'which pip'
        sh './venv/bin/pip install ansible boto3 docker molecule'
      }
    }
    stage('Prep') {
      steps {
        sh 'molecule list'
        sh 'molecule lint'
      }
    }
    stage('Test') {
      steps {
        echo 'Testing...'
        sh 'molecule create'
        sh 'molecule converge'
        sh 'molecule verify'
      }
    }
  }
}
